# mkinitcpio-hook-neoshy v1.2-1

![AUR](https://img.shields.io/aur/version/mkinitcpio-hook-neoshy.svg)
![License: MIT](https://img.shields.io/badge/License-MIT-blue.svg)
![Build](https://img.shields.io/badge/build-makepkg-brightgreen) ![Shell
Style](https://img.shields.io/badge/style-posix--ash-yellow)

üëâ **README –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º:** `README.md`

------------------------------------------------------------------------

## üí° –û–±–∑–æ—Ä

`mkinitcpio-hook-neoshy` --- —ç—Ç–æ –∫–∞—Å—Ç–æ–º–Ω—ã–π —Ö—É–∫ mkinitcpio, –∫–æ—Ç–æ—Ä—ã–π
–ø–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é –∏ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—É—é –∫–æ—Ä–Ω–µ–≤—É—é —Ñ–∞–π–ª–æ–≤—É—é
—Å–∏—Å—Ç–µ–º—É **–¥–æ** –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ —Ö—É–∫–∞ `encrypt`.

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è **–¥–≤–∞ —Ä–µ–∂–∏–º–∞ –∑–∞–≥—Ä—É–∑–∫–∏**:

1.  **–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º:**\
    –ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–æ—Ä–Ω–µ–≤–∞—è –§–° —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ —Ñ–∞–π–ª–∞‚Äë–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (`.img`,
    `.mkv` –∏ –¥—Ä.), —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–Ω–æ–≥–æ –ø—Ä—è–º–æ –Ω–∞ –±–ª–æ—á–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ.

2.  **–í–ª–æ–∂–µ–Ω–Ω—ã–π ("–ú–∞—Ç—Ä–µ—à–∫–∞") —Ä–µ–∂–∏–º:**\
    –§–∞–π–ª‚Äë–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ **plain dm-crypt** –≤–Ω–µ—à–Ω–µ–º –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–º
    —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞ –≤–Ω–µ—à–Ω–µ–º HDD –∏–ª–∏ SSD.\
    –•—É–∫ —Å–Ω–∞—á–∞–ª–∞ —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ—Ç *–≤–Ω–µ—à–Ω–∏–π* —Å–ª–æ–π —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è, –º–æ–Ω—Ç–∏—Ä—É–µ—Ç
    —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É, –Ω–∞—Ö–æ–¥–∏—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –µ–≥–æ
    –∫–∞–∫ loop‚Äë—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ö—É–∫–æ–º `encrypt`.

------------------------------------------------------------------------

## üß© –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### ‚úîÔ∏è **–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º**

-   –ú–æ–Ω—Ç–∏—Ä—É–µ—Ç –±–ª–æ—á–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
-   –ò—â–µ—Ç —Ñ–∞–π–ª –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –ø–æ –ø–∞—Ä–∞–º–µ—Ç—Ä—É `src_rootfs=<device>:<path>`
-   –ü–æ–¥–∫–ª—é—á–∞–µ—Ç –µ–≥–æ –∫ `/dev/loop0`
-   –ü–µ—Ä–µ–¥–∞–µ—Ç –µ–≥–æ —Ö—É–∫—É `encrypt` –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏
    (`cryptdevice=/dev/loop0:root`)

### ‚úîÔ∏è **–í–ª–æ–∂–µ–Ω–Ω—ã–π ("–ú–∞—Ç—Ä–µ—à–∫–∞") —Ä–µ–∂–∏–º**

-   –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ—Ç **–≤–Ω–µ—à–Ω–∏–π** dm-crypt *plain* –¥–µ–≤–∞–π—Å:
    -   –ß–µ—Ä–µ–∑ –≤–≤–æ–¥ –ø–∞—Ä–æ–ª—è
    -   –ß–µ—Ä–µ–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ crypto‚Äë–ø–∞—Ä–∞–º–µ—Ç—Ä—ã
        (`outer_crypto=HASH:CIPHER:KEYSIZE:OFFSET`)
-   –ú–æ–Ω—Ç–∏—Ä—É–µ—Ç —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—É—é –≤–Ω–µ—à–Ω—é—é –§–°
-   –ù–∞—Ö–æ–¥–∏—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (`src_rootfs=:<path/to/container>`)
-   –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç loop‚Äë—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –æ–±—Ä–∞–∑–∞
-   –ü–µ—Ä–µ–¥–∞–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º—É —Ö—É–∫—É `encrypt` –¥–ª—è —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏
    *–≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π* –∫–æ—Ä–Ω–µ–≤–æ–π –§–°

------------------------------------------------------------------------

## üßµ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —è–¥—Ä–∞ (cmdline)

### **–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º**

    src_rootfs=<–∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä_—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞>:/path/to/container.img cryptdevice=/dev/loop0:root root=/dev/mapper/root

### **–í–ª–æ–∂–µ–Ω–Ω—ã–π —Ä–µ–∂–∏–º (–ù–û–í–´–ô)**

    outer_device=<–∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä_—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞> outer_crypto=<hash>:<cipher>:<keysize>:<offset> src_rootfs=:/path/to/inner-container.img cryptdevice=/dev/loop0:root cryptkey=<key_params> crypto=<inner_crypto_params> root=/dev/mapper/root

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã `<–∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä_—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞>`

-   `/dev/sdXY`
-   `UUID=<uuid>`
-   `PARTUUID=<partuuid>`
-   `LABEL=<label>`
-   `PARTLABEL=<partlabel>`

------------------------------------------------------------------------

## üîí –ü—Ä–∏–º–µ—Ä cmdline –¥–ª—è –≤–ª–æ–∂–µ–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞

*(–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –∏ —Å–º–µ—â–µ–Ω–∏—è --- –ø—Ä–∏–º–µ—Ä—ã, –ø–æ–¥—Å—Ç–∞–≤—å—Ç–µ —Å–≤–æ–∏.)*

    outer_device=UUID=XXXX-XXXX outer_crypto=sha256:aes-xts-plain64:256:123456 src_rootfs=:/secure/root/container.img cryptdevice=/dev/loop0:root cryptkey=PARTUUID=YYYYYYYY-YYYY-YYYY-YYYY-YYYYYYYYYYYY:offset:size crypto=sha256:aes-xts-plain64:512:600000:0 root=/dev/mapper/root rw

------------------------------------------------------------------------

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### Arch Linux (AUR)

    yay -S mkinitcpio-hook-neoshy
    # –∏–ª–∏
    paru -S mkinitcpio-hook-neoshy

### –†—É—á–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

    git clone https://aur.archlinux.org/mkinitcpio-hook-neoshy.git
    cd mkinitcpio-hook-neoshy
    makepkg -si

------------------------------------------------------------------------

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ mkinitcpio

### –î–æ–±–∞–≤—å—Ç–µ —Ö—É–∫ –ø–µ—Ä–µ–¥ `encrypt`:

    HOOKS=(base udev autodetect modconf block keyboard neoshy encrypt filesystems fsck)

### –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –º–æ–¥—É–ª–∏:

    MODULES=(dm_mod dm_crypt loop xts aes sha256)

–ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ initramfs:

    sudo mkinitcpio -P

------------------------------------------------------------------------

## üìú –õ–∏—Ü–µ–Ω–∑–∏—è

MIT

Maintainer: Andrei A. Bykov <andreiab9019@gmail.com>

------------------------------------------------------------------------

## üìã –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

–°–º–æ—Ç—Ä–∏—Ç–µ `CHANGELOG.md` –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π.
